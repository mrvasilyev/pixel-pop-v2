C4 Annotation ‚Äî AI Image Generation Mobile App (Pixel Pop‚Äìlike)

C1 ‚Äî System Context Diagram

Actors
	‚Ä¢	End User (Telegram User)
Uses Telegram MiniApp to upload a photo, select a style, and receive an AI-generated image.

External Systems
	‚Ä¢	AI Image Generation Provider
Generates images based on uploaded photo and selected style.
	‚Ä¢	Payment Provider (Telegram Stars)
Handles purchases of image packs.
	‚Ä¢	Object Storage (e.g. S3 / Blob Storage)
Stores generated images.
	‚Ä¢	Notification / Push Service
Delivers generation status updates (optional).

System
	‚Ä¢	AI Image Generation Platform

üìå User interacts only with the mobile app; all processing is server-side.

‚∏ª

C2 ‚Äî Container Diagram (Core)

Telegram MiniApp (React + Vite)

Responsibilities:
	‚Ä¢	Style selection UI
	‚Ä¢	Camera / gallery access
	‚Ä¢	Image upload
	‚Ä¢	Display generation status
	‚Ä¢	Preview, save, share result

Notes:
	‚Ä¢	No heavy logic
	‚Ä¢	Stateless
	‚Ä¢	Auth token stored securely

‚∏ª

Backend API

Responsibilities:
	‚Ä¢	Auth & user identification (Strict `initData` validation)
	‚Ä¢	Rate Limiting & Abuse Prevention
	‚Ä¢	Credit / quota validation
	‚Ä¢	Create generation requests
	‚Ä¢	Read user image history
	‚Ä¢	Expose image metadata

Key APIs:
	‚Ä¢	POST /generation
	‚Ä¢	GET /generation/{id}
	‚Ä¢	GET /my-images
	‚Ä¢	GET /my-images
	‚Ä¢	POST /delete

Contract:
	‚Ä¢	OpenAPI / Swagger Specification (First-class citizen)

‚∏ª

Generation Orchestrator (Async)

Responsibilities:
	‚Ä¢	Consume generation jobs from queue (AWS Simple Queue)
	‚Ä¢	Call external AI model
	‚Ä¢	Handle retries / failures
	‚Ä¢	Update generation status

Pattern:
	‚Ä¢	Event-driven
	‚Ä¢	Horizontally scalable workers

‚∏ª

Message Queue

Responsibilities:
	‚Ä¢	Decouple user request from heavy AI processing
	‚Ä¢	Smooth load spikes
	‚Ä¢	Enable retries and backoff

‚∏ª

Database (Supabase)

Stores:
	‚Ä¢	Users
	‚Ä¢	Image generation requests/response, S3 links
	‚Ä¢	Status (PENDING ‚Üí PROCESSING ‚Üí DONE / FAILED)
	‚Ä¢	Credits usage

Security & Features:
	‚Ä¢	Row Level Security (RLS) for user data isolation
	‚Ä¢	pgvector support (if semantic search is needed)

Access pattern:
	‚Ä¢	Read-heavy
	‚Ä¢	Strong consistency for credits

‚∏ª

Object Storage

Stores:
	‚Ä¢	Generated images (final results - with naming convention incluse telegram userid)

Characteristics:
	‚Ä¢	Large binary objects
	‚Ä¢	CDN-backed for downloads

‚∏ª

External AI Model API

Responsibilities:
	‚Ä¢	Image transformation
	‚Ä¢	Style application

Constraints:
	‚Ä¢	High latency
	‚Ä¢	Expensive
	‚Ä¢	Rate-limited

‚∏ª

C3 ‚Äî Component Diagram (Backend API ‚Äì optional zoom)

Components
	‚Ä¢	Auth Middleware
	‚Ä¢	Generation Controller
	‚Ä¢	Credit Service
	‚Ä¢	Generation Service
	‚Ä¢	Image Repository
	‚Ä¢	User Repository

üìå Only shown if interviewer asks to ‚Äúzoom in‚Äù.

‚∏ª

Mapping UI Screens ‚Üí Architecture

UI Screen	Backend Interaction
Style Gallery	GET /styles (cached)
Camera / Gallery Picker	Client-side only
Upload Photo	POST /generation
Processing Screen	Subscribe to SSE / WebSockets (or Poll GET /generation/{id})
Result Screen	CDN fetch from Object Storage
Save / Share	Client-side + storage URL
My Images	GET /my-images


‚∏ª

Key Design Decisions (Explain Verbally)
	‚Ä¢	Async generation via queue ‚Üí avoids blocking UI
	‚Ä¢	Object storage for images ‚Üí cheap & scalable
	‚Ä¢	Read-heavy optimization for gallery/history
	‚Ä¢	Soft delete for user images (GDPR-ready)
	‚Ä¢	Eventual consistency acceptable for image availability
	‚Ä¢	Server-Sent Events (SSE) preferred over polling for cleaner UX